<!DOCTYPE html>
<html>
  <head>
<!--   	<link rel="Icon" href="assets\icon.png"> -->
    <title>Экологический проект: сортировка отходов</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://ideaspacevr.github.io/aframe-particle-system-component/dist/aframe-particle-system-component.min.js"></script>
  </head>
  <body>
    <div id="formstat" hidden="true">0</div>
    <div id="lifes" hidden="true">5</div>
    <div id="truba">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pngtree-iron-pipe-png-element-png-image_2856510.png"
        style="width: 100%"
      />
    </div>
    <img id="myGif" src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/YwE5.gif?v=1734179925318" style="display: none">
    <script>
      AFRAME.registerComponent("follow", {
        schema: {
          t1: {
            type: "selector",
          },
        },
        init: function () {
          this.target = this.data.t1.object3D;
          this.time = 1000;
          this.originalScale = new THREE.Vector3(1.5, 1.5, 1.5); // Исходный масштаб объекта
          this.maxScale = new THREE.Vector3(2, 2, 2); // Максимальный масштаб для пульсации
        },

        update: function () {
          this.toPosition = this.target.position;
          this.color = Math.floor(Math.random() * 3);
        },

        tick: function (time, timeDelta) {
          this.time += timeDelta;
          let t = Math.abs(((this.time * 0.001) % 2) - 1);
          t = Math.min(t, 0.98);
          t = Math.max(t, 0.02);

          this.inter = new THREE.Vector3();
          this.inter.add(this.toPosition);
          this.inter.multiplyScalar(0.7);
          this.inter.multiplyScalar(t * (1 - t));

          let scaleFactor = Math.abs(Math.sin(this.time * 0.005)) * 0.5 + 1; // Амплитуда колебаний от 1 до 1.5


          let scale = new THREE.Vector3(scaleFactor, scaleFactor, scaleFactor); 


          this.el.setAttribute("scale", scale);
          currentPosition = new THREE.Vector3();
          currentPosition.add(this.toPosition);
          currentPosition.multiplyScalar(t * t);
          currentPosition.add(this.inter);

          this.el.setAttribute("position", currentPosition);
        },
      });
    </script>
    <script>
      AFRAME.registerComponent("random", {
        schema: {
          t1: {
            type: "selector",
          },
          t2: {
            type: "selector",
          },
          t3: {
            type: "int",
            default: 0,
          },
        },
        init: function () {
          this.color = Math.floor(Math.random() * 3) + 1;
          this.form = Math.floor(Math.random() * 2) + 1;
          if (this.data.t3 == 0) {
            this.kubit = Math.floor(Math.random() * 2);
          } else {
            this.kubit == 0;
          }

          if (this.kubit == 0) {
            if (this.color == 1) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plas1.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plas2.png"
                );
              }
            } else if (this.color == 2) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/gla2.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/gla3.png"
                );
              }
            } else if (this.color == 3) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pap2.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pap1.png"
                );
              }
            }
          }

          if (this.kubit == 1) {
            if (this.color == 1) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plas_1.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plas_2.png"
                );
              }
            } else if (this.color == 2) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/gla_1.png"
                );
              }
            } else if (this.form == 2) {
              this.el.setAttribute(
                "src",
                "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/gla_2.png"
              );
            } else if (this.color == 3) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pap_2.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pap_1.png"
                );
              }
            }
          }
        },

        tick: function () {
          this.pos = this.el.getAttribute("position");
          if (this.pos.y >4){
            let gifElement = document.getElementById('myGif');
            
            audioF.play();
            if (gifElement.style.display !== 'block') {
              gifElement.style.display = 'block';
            }

            setTimeout(() => {
              gifElement.style.display = 'none'; 
               gifElement.src = '';  
                gifElement.src = 'https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/YwE5.gif?v=1734179925318'; // Скрываем GIF
            }, 800);  
    
            kub.removeAttribute("follow");
            kub.setAttribute("position", "0 0 0");
            t1.setAttribute("position", "0 0 0");
            kub.setAttribute("follow", "t1: #t1");
            kub.removeAttribute("random");
            kub.setAttribute("random", "t1: #score; t2: #formstat;");
          }
          if (this.pos.x > 1.9){
            // alert("this.kubit");
            setTimeout(() => {
              kub.removeAttribute("follow");
              kub.setAttribute("position", "0 0 0");
              t1.setAttribute("position", "0 0 0");
              kub.setAttribute("follow", "t1: #t1");
            }, 1000);
            this.kubit = 0;
            if (this.color == 1) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plas1.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plas2.png"
                );
              }
            } else if (this.color == 2) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/gla2.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/gla3.png"
                );
              }
            } else if (this.color == 3) {
              if (this.form == 1) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pap2.png"
                );
              } else if (this.form == 2) {
                this.el.setAttribute(
                  "src",
                  "https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pap1.png"
                );
              }
            }
          }
          if (this.pos.z > 1.4) {
            // alert(this.form);
            // alert(this.kubit);
            if (this.kubit == 1) {
              // alert(this.kubit);
              endGame();
              setTimeout(() => {
                restart();
              }, 4000);
            }
            // alert(this.data.t2.textContent);
            // alert(this.color);
            if ((this.color == 1) && (this.kubit == 0)) {
                if (this.pos.x < -1) {
                  console.log("entrd");
                  addScore();
                } else {
                  removeLife();
                }
            
              } else if ((this.color == 2) && (this.kubit == 0)) {
                if (this.pos.x  > 1) {
                  console.log("entgr");
                  addScore();
                } else {
                  removeLife();
                }
              } else if ((this.color == 3) && (this.kubit == 0)){
                if (this.pos.x < 1) {
                  console.log("entbl");
                  addScore();
                } else {
                  removeLife();
                }
              } 
              // } else if (((this.pos.x < -1) && (this.color != 1)) || ((this.pos.x > 1) && (this.color != 2)) || ((this.pos.x < 1) && (this.color != 3))) {
              //   // alert(this.color);
              //     removeLife();
              //   } 
//             if (this.data.t2.textContent != this.form-1) {
//               removeLife();
//             } else {
//               if (this.color == 1) {
//                 if (this.pos.x > 1) {
//                   console.log("entrd");
//                   addScore();
//                 }
//               } else if (this.color == 2) {
//                 if (this.pos.x < -1) {
//                   console.log("entgr");

//                   addScore();
//                 }
//               } else if (this.color == 3) {
//                 if (this.pos.x < 1) {
//                   console.log("entbl");
//                   addScore();
//                 }
//               }
//             }
            kub.removeAttribute("follow");
            kub.setAttribute("position", "0 0 0");
            t1.setAttribute("position", "0 0 0");
            kub.setAttribute("follow", "t1: #t1");
            kub.removeAttribute("random");
            kub.setAttribute("random", "t1: #score; t2: #formstat;");
          }
        },
      });
    </script>
    <a-scene vr-mode-ui="enabled: false">
      <a-marker
        type="pattern"
        url="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pattern-photo_5402319374146200778_y.patt"
      >
        <a-sphere
          visible="false"
          radius="0"
          id="t1"
          position="0 0 0"
        ></a-sphere>
        <a-image
          id="kub"
          follow="t1: #t1;"
          position="0 0.2 0"
          scale="1 1 1"
          rotation="0 0 0"
          animation-mixer="timeScale: 1"
          random="t1: #score; t2: #formstat;"
        ></a-image>
        <a-entity
          geometry="primitive: plane"
          rotation="270 0 0"
          scale="5 3 4"
          position="0 -1 0.5"
          material="src: https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/0d91e2e7-10b3-44e3-9f53-12b1e89d21a9.png"
        ></a-entity>
<a-image
  id="priR"
  src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/glass.png"
  position="1.5 0 1.5"
  scale="1.2 1.2 1.2" 
></a-image> 
<a-image
  id="priB"
  src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/paper.png"
  position="0 0 1.5"
  scale="1.2 1.2 1.2"
></a-image> 
<a-image
  id="priG"
  src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plastic.png"
  position="-1.5 0 1.5"
  scale="1.2 1.2 1.2"
></a-image> 
      </a-marker>
      <a-marker
        type="pattern"
        url="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pattern-plastic.patt"
        id="green"
      > <!-- СЮДА МАРКЕР ДЛЯ СОРТИРОВКИ В ПЛАСТИК КОРЗИНУ-->
        <a-image
          src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/plastic.png"
          scale="1.2 1.2 1.2"
        ></a-image> 
      </a-marker>
      <a-marker
        type="pattern"
        url="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pattern-photo_5404453590640223866_x.patt"
        id="destroy"
      > <!-- СЮДА МАРКЕР УНИЧТОЖЕНИЯ НЕВЕРНОГО МУСОРА ДЛЯ ТРЕХ КОРЗИН-->
        <a-image
          id="priС"
          src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/fire_fire.png"
          scale="1.2 1.2 1.2"
        ></a-image> <!-- СЮДА БОМБУ ИЛИ ЯЩИК-->
      </a-marker> 
      <a-marker
        type="pattern"
        url="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pattern-clean-up.patt"
        id="change"
      > <!-- СЮДА МАРКЕР ИЗМЕНЕНИЯ МУСОРА НА ЧИСТЫЙ ЛЮБОЙ-->
        <a-image
          id="priDest"
          src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/clean.png"
          scale="1.2 1.2 1.2"
        ></a-image> <!-- СЮДА КАРТИНКУ ОТМЫВАНИЯ МУСОРА ДЛЯ ИЗМЕНЕНИЯ-->
      </a-marker>
      <a-marker
        type="pattern"
        url="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pattern-glass.patt"
        id="red"
      > <!-- СЮДА МАРКЕР СТЕКЛО КОРЗИНЫ-->
        <a-image
          src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/glass.png"
          scale="1.2 1.2 1.2"
        ></a-image> 
      </a-marker>
      <a-marker
        type="pattern"
        url="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pattern-paper.patt"
        id="blue"
      > <!-- СЮДА МАРКЕР БУМАГА КОРЗИНЫ-->
        <a-image
          src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/paper.png"
          scale="1.2 1.2 1.2"
        ></a-image> 
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const markerr = document.getElementById("red");
      const markerg = document.getElementById("green");
      const markerb = document.getElementById("blue");
      const mdest = document.getElementById("destroy");
      const mchan = document.getElementById("change");
      const rbox = document.getElementById("priR"); <!-- ТЕ САМЫЕ ТРИ КОРЗИНЫ КОТОРЫЕ НА ЗЕЛЕНОЙ ТРАВКЕ ИЗМЕНИТЬ-->
      const gbox = document.getElementById("priB");
      const bbox = document.getElementById("priG");
      const bch = document.getElementById("priC");
      const formst = document.getElementById("formstat");
      const target = document.getElementById("t1");
      const kub = document.getElementById("kub");
      let form = 0;

      mdest.addEventListener("markerLost", () => {
        kub.removeAttribute("follow");
        kub.setAttribute("position", "0 0 0");
        t1.setAttribute("position", "0  5 0");
        kub.setAttribute("follow", "t1: #t1");
      });
       mchan.addEventListener("markerLost", () => {
        kub.removeAttribute("follow");
        kub.setAttribute("position", "0 0 0");
        t1.setAttribute("position", "2 0 0");
        kub.setAttribute("follow", "t1: #t1");

        setTimeout(() => {
          bch.setAttribute(
            "particle-system",
            "color: #0000AA; particleCount: 200"
          );
          setTimeout(() => {
            bch.removeAttribute("particle-system");
          }, 500);
        }, 500);
      });
      markerr.addEventListener("markerLost", () => {
        kub.removeAttribute("follow");
        kub.setAttribute("position", "0 0 0");
        t1.setAttribute("position", "1.5 0 1.5");
        kub.setAttribute("follow", "t1: #t1");
      });
      markerg.addEventListener("markerLost", () => {
        kub.removeAttribute("follow");
        kub.setAttribute("position", "0 0 0");
        t1.setAttribute("position", "-1.5 0 1.5");
        kub.setAttribute("follow", "t1: #t1");
      });
      markerb.addEventListener("markerLost", () => {
        kub.removeAttribute("follow");
        kub.setAttribute("position", "0 0 0");
        t1.setAttribute("position", "0 0 1.5");
        kub.setAttribute("follow", "t1: #t1");
      });
    </script>

    <div id="for_countc">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/score2.png"
        style="width: 100%"
      />
    </div> <!-- картинка для счета -->
    <div id="score">0</div>
    <div id="for_life">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/life3.png"
        style="width: 100%"
      />
    </div> <!-- картинка для жизней -->
    <div id="life">5</div>
    <div id="end" style="display: none">Игра закончилась</div> <!-- конец игры надпись -->
    <div id="restart">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/restart3.png"
        style="width: 100%"
      />
    </div> <!-- картинка перезапуска -->

    <div id="info">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/info2.png"
        style="width: 100%"
      />
    </div> <!-- картинка для инфы -->
<!-- ИСПРАВИТЬ НА СВОЕ -->  <div class="overlay">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/pravila2.png"
        style="height: 70%"
      />
    </div> <!-- картинка правил игры -->

    <div id="for_time">
      <img
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/time.png"
        style="width: 100%"
      /> <!-- картинка для таймера -->
    </div>
    <div id="time"></div>
    <div id="background" style="display: none"></div>
<!--     <audio controls="controls" id="audio" autoplay loop style="display: none" volume="0.1">
      <source
        src="assets/background_music.mp3"
        type="audio/wav"
      />
      <source
        src="assets/background_music.mp3"
        type="audio/mpeg"
      />
    </audio> -->
        <audio controls="controls" id="myAudio" autoplay loop style="display: none" volume="0.1">
      <source
        src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/81cebf7e45fdef7.mp3"
        type="audio/mpeg"
      />
    </audio>
  <audio id="audioB" src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/multyashnyiy-zvuk-najatiya-na-knopku-30362.mp3"></audio>
    <audio id="audioF" src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/ac20aa2b8d61b79.mp3"></audio>
    <audio id="audioR" src="https://cdn.glitch.global/9e81f393-8509-425e-9433-ae86b9932127/zvonkiy-zvuk-najatiya-knopki1.mp3"></audio>
 

    <script>
      const infoButton = document.querySelector("#info");
      const overlay = document.querySelector(".overlay");
      const audioB = document.getElementById('audioB');
      let timerPaused = false;

      infoButton.addEventListener("click", function () {
        audioB.play();
        overlay.style.display = "block";
        pauseTimer();
      });

      overlay.addEventListener("click", function () {
        overlay.style.display = "none";
        resumeTimer();
      });
      // Функция для постановки таймера на паузу
      function pauseTimer() {
        timerPaused = true;
      }

      // Функция для возобновления таймера
      function resumeTimer() {
        timerPaused = false;
      }
    </script>

    <script>
      const score = document.querySelector("#score");
      const life = document.querySelector("#life");
      const end = document.querySelector("#end");
      const start = document.querySelector("#restart");
      const time = document.querySelector("#time");
      const background = document.querySelector("#background");
      const body = document.querySelector("body");
      // поинтов
      let points = 0;
      //жизней
      let lifes = 5;
      // осталось времени
      let left = 300;
      const audioElement = document.getElementById('myAudio');
      let interval;
      
			// const backgroundMusic = document.getElementById("audio");
			// backgroundMusic.volume = 0.5;
			// const startAudio = () => {
			// let audio = document.createElement("div");
			// audio.innerHTML = `<audio controls="controls" id="audio" autoplay loop style="display: none">
			// 	<source
			// 		src="assets/pop.mp3"
			// 		type="audio/wav"
			// 	/>
			// 	<source
			// 		src="assets/pop.mp3"
			// 		type="audio/mpeg"
			// 	/>
			// </audio>`;
			// body.insertAdjacentElement("beforeend", audio);
			// setTimeout(() => {
			// body.removeChild(audio);
			// }, 1000);
			// };

      // увеличение очков и обновление счётчика
      const addScore = () => {
        ++points;
        score.textContent = `${points}`; // Обновление счётчика очков
      };

      // уменьшение очков и обновление счётчика
      const removeScore = () => {
        --points;
        score.textContent = `${points}`; // Обновление счётчика очков
      };

      // увеличение жизней и обновление счётчика
      const addLife = () => {
        ++lifes;
        life.textContent = `${lifes}`; // Обновление счётчика жизней
      };

      // показывание бэкграунда и сообщение об окончании игры
      const endGame = () => {
        audioElement.pause();        // Останавливаем аудио
        audioElement.currentTime = 0; 
        end.textContent = `Игра окончена. Ваш счет: ${points}`;
        end.setAttribute("style", "display: block;");
        background.setAttribute("style", "display: block;");
      };

      const intervalSet = () => {
    interval = setInterval(() => {
        if (!timerPaused) {
            --left;
            setTime();
            if (left === 0) {
                endGame();
                clearInterval(interval); // Останавливаем таймер, если время вышло
                return;
            }
        }
    }, 1000);
};

      intervalSet();

      // уменьшение очков и обновление счётчика
      const removeLife = () => {
        --lifes;
        if (lifes === 0) {
          endGame();
        }
        life.textContent = `${lifes}`; // Обновление счётчика жизней
      };

      // обновление счётчика времени
      const setTime = () => {
        let seconds =
          `${left % 60}`.length === 1 ? `0${left % 60}` : `${left % 60}`;
        time.textContent = `0${Math.floor(left / 60)}:${seconds}`;
      };

      // рестарт всех параметров и обновление счётчиков
      const restart = () => {
        audioElement.play();
        audioR.play();
        left = 300;
        points = 0;
        lifes = 5;
        // startAudio();
        end.setAttribute("style", "display: none;");
        background.setAttribute("style", "display: none;");
        clearInterval(interval); // Останавливаем старый интервал
    setTime(); // Сбрасываем время на 90 секунд
    intervalSet(); // Перезапускаем интервал
        
        life.textContent = `${lifes}`; // Обновление счётчика жизней
        score.textContent = `${points}`; // Обновление счётчика очков
      };

      // рестарт игры при клике на кнопку
      start.addEventListener("click", (e) => {
        restart();
      });
    </script>
  </body>
</html>
